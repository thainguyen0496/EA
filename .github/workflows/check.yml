name: MQL5-Compile-Direct
on: [push]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download MetaEditor
        shell: powershell
        run: |
          # Tải bộ MetaEditor từ nguồn uy tín và ổn định
          $url = "https://raw.githubusercontent.com/swisstrader/MQL5-Docker/master/Metatrader/metaeditor64.exe"
          Invoke-WebRequest -Uri $url -OutFile "metaeditor64.exe"

      - name: Compile EA
        shell: powershell
        run: |
          # Tạo thư mục tạm để MetaEditor không báo lỗi môi trường
          New-Item -ItemType Directory -Force -Path "MQL5/Experts"
          
          # Chạy biên dịch file của bạn
          # Lưu ý: Sửa 'Experts/MyEA.mq5' nếu bạn đặt tên file khác
          ./metaeditor64.exe /compile:"Experts/MyEA.mq5" /log:"log.txt" /inc:"."
          
          # Hiển thị kết quả ra màn hình
          if (Test-Path "log.txt") { Get-Content "log.txt" }
          
          if (Test-Path "Experts/MyEA.ex5") {
              Write-Host "✅ THANH CONG! Code ban da chuan."
          } else {
              Write-Host "❌ LOI ROI! Hay kiem tra chi tiet phia tren."
              exit 1
          }
