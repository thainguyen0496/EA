name: MQL5-Fast-Compile
on: [push]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup MetaEditor
        shell: powershell
        run: |
          # Tải trực tiếp file chạy MetaEditor, không cần cài đặt rườm rà
          Invoke-WebRequest -Uri "https://github.com/dingmaotu/mql-tools/raw/master/bin/metaeditor64.exe" -OutFile "metaeditor64.exe"

      - name: Compile EA
        shell: powershell
        run: |
          # Chạy lệnh biên dịch và xuất nhật ký ra file log
          ./metaeditor64.exe /compile:"Experts/MyEA.mq5" /log /inc:"."
          
          # Đợi 2 giây để file log kịp ghi xong
          Start-Sleep -s 2

          # Kiểm tra kết quả và hiển thị lỗi nếu có
          if (Test-Path "Experts/MyEA.ex5") {
              Write-Host "✅ THANH CONG! Code ban rat tot."
          } else {
              Write-Host "❌ LOI ROI! Chi tiet loi nhu sau:"
              if (Test-Path "Experts/MyEA.log") { Get-Content "Experts/MyEA.log" }
              exit 1
          }
